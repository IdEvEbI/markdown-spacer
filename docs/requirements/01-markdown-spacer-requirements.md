---
**文档标题**：markdown-spacer 产品需求文档
**文档版本**：v1.1
**创建时间**：2025-07-20
**更新时间**：2025-07-22
**维护人员**：刘凡 & 小克
**文档状态**：已完成
---

# markdown-spacer 产品需求文档

## 1. 项目概述

### 1.1 项目目标

开发一个 Python 命令行工具，专门处理 Markdown 文档中英文数字间的空格问题，提升文档的可读性和规范性。

### 1.2 核心价值

- **提升阅读体验**：通过规范的中英文间距改善文档可读性
- **自动化处理**：减少手动格式化的重复工作
- **批量处理**：支持单个文件或目录的批量格式化

## 2. 功能需求

### 2.1 核心功能

- **中英文空格处理**：自动在中英文、数字之间添加或删除空格
- **Markdown 文件识别**：只处理 `.md` 和 `.markdown` 文件
- **Markdown 内容验证**：只处理符合 Markdown 格式的文件（首个非空行以 `#` 或 `---` 开头）
- **批量处理**：支持单个文件、目录处理，可选递归模式
- **结构内空格处理**：表格、列表项、标题、引用块等 Markdown 结构内的内容也会自动进行中英文空格处理，不会整体跳过

### 2.2 使用方式

```text
脚本 文档名 → 直接修复，提示修改详情
```

### 2.3 参数支持

- **静默模式**：直接修复不提示任何信息
- **递归模式**：遍历查找目录下所有 Markdown 文件
- **备份模式**：备份原文件（默认关闭）

## 3. 技术需求

### 3.1 代码质量

- **代码规范**：符合高级 Python 程序员水准，易于阅读
- **静态检查**：通过 flake8 语法检查
- **避免重复**：不出现重复检查修复的浪费行为

### 3.2 输出格式

- **修改位置**：显示修改的函数位置
- **修改内容**：显示具体的修改内容
- **统计信息**：显示总修改次数等统计信息

### 3.3 错误处理

- **文件识别**：非 Markdown 文件直接提示无法识别并处理
- **内容验证**：不符合 Markdown 格式的文件（首个非空行不以 `#` 或 `---` 开头）会被跳过
- **读取异常**：文件读取失败时提示错误信息

### 3.4 测试支持

- **单元测试**：支持通过修改测试用例增加规则
- **性能评估**：提供性能评估报告

## 4. 特殊规则

### 4.1 待定规则

- 具体的中英文混排规则将在开发阶段通过实际 Markdown 文档测试确定
- 基于测试文档生成精确的格式化规则
- **结构内空格处理说明**：除代码块、行内代码、链接、图片、数学公式等特殊内容外，表格、列表项、标题、引用块等结构内的内容也会自动进行中英文空格处理

### 4.2 规则扩展

- 支持通过单元测试用例扩展和调整规则
- 保持规则的灵活性和可维护性

### 4.3 数字与单位、版本号、路径特殊规则

- **文档版本号**：如 v1.0、v2.3 等，不应在 v 和数字之间添加空格。
- **数字与单位**：如 10MB、100GB、5ms、20℃ 等，数字与单位之间不应自动添加空格。
- **技术缩写与编码名**：如 UTF-8、ASCII、GBK、JSON-LD 等技术缩写、编码名、协议名等，不应加空格，保持原样。
- **带连字符的技术缩写保护**：如 UTF-8、JSON-LD、ISO-8859-1、RFC-2616 等，连字符两侧不应加空格，整体保持原样。
- **路径和文件名**：如 src/core/formatter.py，如果被反引号 ` 包裹（如 `src/core/formatter.py`），不应修改；未被反引号包裹时，可自动加空格（如 src / core / formatter. py）。
- **斜杠分隔符**：如 文本/JSON，建议自动加空格（文本 / JSON）。
- **编号与中文**：如 优先级1，建议自动加空格（优先级 1）。
- **文件扩展名**：如 .md、.markdown，如果被反引号 ` 包裹（如 `.md`、`.markdown`），不应加空格；未被反引号包裹时，可自动加空格（如 . md、. markdown）。
- **被反引号包裹的内容保护**：所有被反引号 ` 包裹的文件名、路径、扩展名等，均不应加空格。
- **数字+单位+加号表达**：如 4GB+、8GB+ 等，可以不加空格，保持原样。
- **文件名格式保护**：如 requirements.txt、requirements-dev.txt、setup.py、pyproject.toml、.pre-commit-config.yaml 等，无论是否被反引号包裹，不应加空格。建议 formatter 用正则直接匹配和保护常见文件名、路径格式（如 xxx.txt、xxx-xxx.py、.xxx、xxx/xxx.xxx 等）。
- **工具名与命令名保护**：如 flake8、black、isort、mypy 等工具名、命令名、技术缩写，不应加空格，保持原样。
- **比较符号与数字/单位间空格**：如 > 10MB、<= 5ms，比较符号（>、<、>=、<=、=、!=、＞、＜、≥、≤、＝、≠）与数字/单位之间应有空格，自动修复 >10MB 为 > 10MB，＞100GB 为 ＞ 100GB。
- **多个连续空格合并**：文档中出现多个连续空格时，自动合并为一个空格，优先级最高。

### 特殊内容保护规则

以下内容在格式化时会被完整跳过，不做空格、加粗等处理：

- 代码块（以 ``` 包裹的多行代码块，或以 ` 包裹的行内代码）
- 数学公式（以 $...$ 或 $$...$$ 包裹的内容）
- 链接（如 [text](url)）
- 图片（如 ![alt](url)）
- HTML 标签（如 `<span>内容</span>`）

表格、列表、标题、引用块等结构内的内容会被格式化，不属于特殊内容保护范围。

保护机制采用正则与状态机结合，确保上述内容不会被误处理。

本规则与 formatter.py 实现和测试用例保持一致。

## 5. 项目约束

### 5.1 技术约束

- 使用 Python + 正则表达式实现
- 不过度设计，保持代码简洁
- 符合高级 Python 开发规范

### 5.2 文档要求

- 配套设计文档
- 使用说明文档
- 测试用例文档

## 6. 成功标准

### 6.1 功能标准

- 正确处理中英文数字间的空格问题
- 支持所有指定的使用场景和参数
- 错误处理完善，用户体验良好

### 6.2 质量标准

- 代码通过 flake8 检查
- 单元测试覆盖率达标
- 性能满足批量处理需求

## 7. 表达与排版优化建议

- **状态/类型等枚举信息**：用加粗（**...**）和空格分隔，提升可读性。例如：**已完成 / 已归档**
- **结构化表达**：如“问题 - 分析 - 建议”等结构，建议用加粗和空格分隔，避免直接用引号或无格式的连字符。
- **编号样式**：如章节编号、状态编号等，建议用代码格式（如 `1.`、`1.1`、`1.1.1`）高亮，表达更直观。
- **中文双引号加粗**：可选，将“...”内内容加粗（如“你好”→**你好**）。嵌套双引号内容不会被加粗，只有非嵌套的“...”才会加粗。
